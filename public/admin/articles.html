<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>文章管理 - 博客管理系统</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#3B82F6',
                        secondary: '#10B981',
                        dark: '#1F2937',
                        light: '#F9FAFB',
                        danger: '#EF4444'
                    },
                    fontFamily: {
                        sans: ['Inter', 'system-ui', 'sans-serif'],
                    },
                }
            }
        }
    </script>
    <style type="text/tailwindcss">
        @layer utilities {
            .content-auto {
                content-visibility: auto;
            }
            .sidebar-link {
                @apply flex items-center px-4 py-3 text-gray-700 hover:bg-primary hover:text-white transition-colors duration-200;
            }
            .sidebar-link.active {
                @apply bg-primary text-white;
            }
            .table-row {
                @apply hover:bg-gray-50 transition-colors;
            }
        }
    </style>
</head>
<body class="bg-gray-100 font-sans text-gray-800 min-h-screen">
    <div class="flex h-screen overflow-hidden">
        <!-- 侧边栏 -->
        <aside class="bg-white w-64 shadow-md hidden md:block">
            <div class="p-6 border-b border-gray-200">
                <h1 class="text-xl font-bold text-primary flex items-center">
                    <i class="fa fa-tachometer mr-2" aria-hidden="true"></i>
                    <span>博客管理系统</span>
                </h1>
            </div>
            <nav class="py-4">
                <a href="index.html" class="sidebar-link">
                    <i class="fa fa-home w-6" aria-hidden="true"></i>
                    <span class="ml-3">控制台</span>
                </a>
                <a href="articles.html" class="sidebar-link active">
                    <i class="fa fa-file-text-o w-6" aria-hidden="true"></i>
                    <span class="ml-3">文章管理</span>
                </a>
                <a href="messages.html" class="sidebar-link">
                    <i class="fa fa-comments-o w-6" aria-hidden="true"></i>
                    <span class="ml-3">留言管理</span>
                </a>
                <a href="categories.html" class="sidebar-link">
                    <i class="fa fa-folder-o w-6" aria-hidden="true"></i>
                    <span class="ml-3">分类管理</span>
                </a>
                <a href="settings.html" class="sidebar-link">
                    <i class="fa fa-cog w-6" aria-hidden="true"></i>
                    <span class="ml-3">系统设置</span>
                </a>
            </nav>
            <div class="absolute bottom-0 w-full border-t border-gray-200">
                <button id="logout-btn" class="sidebar-link w-full justify-start">
                    <i class="fa fa-sign-out w-6" aria-hidden="true"></i>
                    <span class="ml-3">退出登录</span>
                </button>
            </div>
        </aside>
        
        <!-- 主内容区 -->
        <div class="flex-1 flex flex-col overflow-hidden">
            <!-- 顶部导航 -->
            <header class="bg-white shadow-sm py-4 px-6 flex justify-between items-center">
                <button id="mobile-menu-toggle" class="md:hidden text-gray-600 focus:outline-none">
                    <i class="fa fa-bars text-xl" aria-hidden="true"></i>
                </button>
                <div class="flex items-center">
                    <span class="text-gray-500 mr-4">欢迎回来，管理员</span>
                    <img src="https://picsum.photos/id/64/40/40" alt="管理员头像" class="w-8 h-8 rounded-full">
                </div>
            </header>
            
            <!-- 页面内容 -->
            <main class="flex-1 overflow-y-auto p-6">
                <div class="mb-6 flex flex-col md:flex-row md:justify-between md:items-center gap-4">
                    <div>
                        <h2 class="text-2xl font-bold">文章管理</h2>
                        <p class="text-gray-600 mt-1">管理所有博客文章</p>
                    </div>
                    <div class="flex flex-col sm:flex-row gap-3">
                        <a href="edit-article.html" class="px-4 py-2 bg-primary hover:bg-primary/90 text-white rounded-lg transition-colors flex items-center justify-center">
                            <i class="fa fa-plus mr-2" aria-hidden="true"></i>
                            新建文章
                        </a>
                        <button id="refresh-btn" class="px-4 py-2 border border-gray-300 rounded-lg text-gray-700 bg-white hover:bg-gray-50 transition-colors flex items-center justify-center">
                            <i class="fa fa-refresh mr-2" aria-hidden="true"></i>
                            刷新列表
                        </button>
                    </div>
                </div>
                
                <!-- 搜索和筛选 -->
                <div class="bg-white rounded-lg shadow-md p-4 mb-6">
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div class="relative">
                            <input type="text" id="search-input" placeholder="搜索文章标题..."
                                class="w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/50">
                            <i class="fa fa-search absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400" aria-hidden="true"></i>
                        </div>
                        <div>
                            <select id="category-filter" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/50">
                                <option value="">所有分类</option>
                                <option value="emotion">情感记录</option>
                                <option value="tech">技术分享</option>
                            </select>
                        </div>
                        <div>
                            <select id="status-filter" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/50">
                                <option value="">所有状态</option>
                                <option value="published">已发布</option>
                                <option value="draft">草稿</option>
                            </select>
                        </div>
                    </div>
                </div>
                
                <!-- 文章列表 -->
                <div class="bg-white rounded-lg shadow-md overflow-hidden mb-6">
                    <div class="overflow-x-auto">
                        <table class="min-w-full divide-y divide-gray-200">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">标题</th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">分类</th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">状态</th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">创建时间</th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">操作</th>
                                </tr>
                            </thead>
                            <tbody id="articles-table-body" class="bg-white divide-y divide-gray-200">
                                <!-- 文章列表将通过JavaScript动态加载 -->
                                <tr class="text-center">
                                    <td colspan="5" class="px-6 py-10 text-gray-500">
                                        <i class="fa fa-spinner fa-spin mr-2" aria-hidden="true"></i> 加载中...
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    
                    <!-- 分页 -->
                    <div id="pagination" class="px-6 py-4 border-t border-gray-200 flex items-center justify-between">
                        <div class="flex-1 flex justify-between sm:hidden">
                            <button id="prev-page-mobile" class="relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50">
                                上一页
                            </button>
                            <button id="next-page-mobile" class="ml-3 relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50">
                                下一页
                            </button>
                        </div>
                        <div class="hidden sm:flex-1 sm:flex sm:items-center sm:justify-between">
                            <div>
                                <p class="text-sm text-gray-700">
                                    显示第 <span id="start-item">1</span> 至 <span id="end-item">10</span> 条，共 <span id="total-items">0</span> 条结果
                                </p>
                            </div>
                            <div>
                                <nav class="relative z-0 inline-flex rounded-md shadow-sm -space-x-px" aria-label="Pagination">
                                    <button id="prev-page" class="relative inline-flex items-center px-2 py-2 rounded-l-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50">
                                        <span class="sr-only">上一页</span>
                                        <i class="fa fa-chevron-left" aria-hidden="true"></i>
                                    </button>
                                    <div id="page-numbers" class="flex">
                                        <!-- 页码将通过JavaScript动态加载 -->
                                    </div>
                                    <button id="next-page" class="relative inline-flex items-center px-2 py-2 rounded-r-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50">
                                        <span class="sr-only">下一页</span>
                                        <i class="fa fa-chevron-right" aria-hidden="true"></i>
                                    </button>
                                </nav>
                            </div>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- 移动端侧边栏 -->
    <div id="mobile-sidebar" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden md:hidden">
        <div class="bg-white h-full w-64 shadow-xl transform transition-transform">
            <div class="p-6 border-b border-gray-200 flex justify-between items-center">
                <h1 class="text-xl font-bold text-primary flex items-center">
                    <i class="fa fa-tachometer mr-2" aria-hidden="true"></i>
                    <span>博客管理系统</span>
                </h1>
                <button id="close-mobile-sidebar" class="text-gray-500 hover:text-gray-700">
                    <i class="fa fa-times text-xl" aria-hidden="true"></i>
                </button>
            </div>
            <nav class="py-4">
                <a href="index.html" class="sidebar-link block">
                    <i class="fa fa-home w-6" aria-hidden="true"></i>
                    <span class="ml-3">控制台</span>
                </a>
                <a href="articles.html" class="sidebar-link active block">
                    <i class="fa fa-file-text-o w-6" aria-hidden="true"></i>
                    <span class="ml-3">文章管理</span>
                </a>
                <a href="messages.html" class="sidebar-link block">
                    <i class="fa fa-comments-o w-6" aria-hidden="true"></i>
                    <span class="ml-3">留言管理</span>
                </a>
                <a href="categories.html" class="sidebar-link block">
                    <i class="fa fa-folder-o w-6" aria-hidden="true"></i>
                    <span class="ml-3">分类管理</span>
                </a>
                <a href="settings.html" class="sidebar-link block">
                    <i class="fa fa-cog w-6" aria-hidden="true"></i>
                    <span class="ml-3">系统设置</span>
                </a>
                <a href="#" id="mobile-logout-btn" class="sidebar-link block">
                    <i class="fa fa-sign-out w-6" aria-hidden="true"></i>
                    <span class="ml-3">退出登录</span>
                </a>
            </nav>
        </div>
    </div>

    <!-- 删除确认模态框 -->
    <div id="delete-modal" class="fixed inset-0 bg-black/70 z-50 hidden flex items-center justify-center p-4">
        <div class="bg-white rounded-lg shadow-xl max-w-md w-full">
            <div class="p-6">
                <h3 class="text-xl font-bold text-gray-900 mb-2">确认删除</h3>
                <p class="text-gray-600 mb-6">确定要删除这篇文章吗？此操作无法撤销。</p>
                <div class="flex justify-end space-x-3">
                    <button id="cancel-delete" class="px-4 py-2 border border-gray-300 rounded-lg text-gray-700 bg-white hover:bg-gray-50 transition-colors">
                        取消
                    </button>
                    <button id="confirm-delete" class="px-4 py-2 bg-danger hover:bg-danger/90 text-white rounded-lg transition-colors">
                        <i class="fa fa-trash mr-2" aria-hidden="true"></i>
                        删除
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- 通知提示 -->
    <div id="notification" class="fixed bottom-6 right-6 px-6 py-3 rounded-lg shadow-lg transform translate-y-20 opacity-0 transition-all duration-300 flex items-center z-50">
        <i id="notification-icon" class="mr-2 text-xl"></i>
        <span id="notification-message"></span>
    </div>

    <script>
        // DOM元素
        const mobileMenuToggle = document.getElementById('mobile-menu-toggle');
        const mobileSidebar = document.getElementById('mobile-sidebar');
        const closeMobileSidebar = document.getElementById('close-mobile-sidebar');
        const logoutBtn = document.getElementById('logout-btn');
        const mobileLogoutBtn = document.getElementById('mobile-logout-btn');
        const articlesTableBody = document.getElementById('articles-table-body');
        const searchInput = document.getElementById('search-input');
        const categoryFilter = document.getElementById('category-filter');
        const statusFilter = document.getElementById('status-filter');
        const refreshBtn = document.getElementById('refresh-btn');
        const deleteModal = document.getElementById('delete-modal');
        const cancelDelete = document.getElementById('cancel-delete');
        const confirmDelete = document.getElementById('confirm-delete');
        const notification = document.getElementById('notification');
        const notificationIcon = document.getElementById('notification-icon');
        const notificationMessage = document.getElementById('notification-message');
        const prevPage = document.getElementById('prev-page');
        const nextPage = document.getElementById('next-page');
        const prevPageMobile = document.getElementById('prev-page-mobile');
        const nextPageMobile = document.getElementById('next-page-mobile');
        const pageNumbers = document.getElementById('page-numbers');
        const startItem = document.getElementById('start-item');
        const endItem = document.getElementById('end-item');
        const totalItems = document.getElementById('total-items');
        
        // 分页参数
        let currentPage = 1;
        const pageSize = 10;
        let totalPages = 1;
        let articles = [];
        let selectedArticleId = null;
        
        // 移动端侧边栏控制
        function openMobileSidebar() {
            mobileSidebar.classList.remove('hidden');
            setTimeout(() => {
                mobileSidebar.querySelector('div').classList.add('translate-x-0');
                mobileSidebar.querySelector('div').classList.remove('-translate-x-full');
            }, 10);
        }
        
        function closeMobileSidebarMenu() {
            mobileSidebar.querySelector('div').classList.remove('translate-x-0');
            mobileSidebar.querySelector('div').classList.add('-translate-x-full');
            setTimeout(() => {
                mobileSidebar.classList.add('hidden');
            }, 300);
        }
        
        // 显示通知
        function showNotification(message, isSuccess = true) {
            notificationMessage.textContent = message;
            notificationIcon.className = isSuccess 
                ? 'fa fa-check-circle text-green-500 mr-2 text-xl' 
                : 'fa fa-exclamation-circle text-red-500 mr-2 text-xl';
            notification.className = `fixed bottom-6 right-6 px-6 py-3 rounded-lg shadow-lg transform translate-y-0 opacity-100 transition-all duration-300 flex items-center z-50 ${
                isSuccess ? 'bg-green-50 text-green-800 border border-green-200' : 'bg-red-50 text-red-800 border border-red-200'
            }`;
            
            // 3秒后隐藏
            setTimeout(() => {
                notification.className = 'fixed bottom-6 right-6 px-6 py-3 rounded-lg shadow-lg transform translate-y-20 opacity-0 transition-all duration-300 flex items-center z-50';
            }, 3000);
        }
        
        // 格式化日期
        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('zh-CN', {
                year: 'numeric',
                month: '2-digit',
                day: '2-digit',
                hour: '2-digit',
                minute: '2-digit'
            });
        }
        
        // 获取分类名称
        function getCategoryName(categoryValue) {
            const categories = {
                'emotion': '情感记录',
                'tech': '技术分享'
            };
            return categories[categoryValue] || categoryValue;
        }
        
        // 获取状态显示
        function getStatusDisplay(status) {
            if (status === 'published') {
                return '<span class="px-2 py-1 text-xs font-medium rounded-full bg-green-100 text-green-800">已发布</span>';
            } else if (status === 'draft') {
                return '<span class="px-2 py-1 text-xs font-medium rounded-full bg-gray-100 text-gray-800">草稿</span>';
            }
            return status;
        }
        
        // 加载文章列表
        async function loadArticles() {
            try {
                // 显示加载状态
                articlesTableBody.innerHTML = `
                    <tr class="text-center">
                        <td colspan="5" class="px-6 py-10 text-gray-500">
                            <i class="fa fa-spinner fa-spin mr-2" aria-hidden="true"></i> 加载中...
                        </td>
                    </tr>
                `;
                
                // 获取搜索和筛选条件
                const searchTerm = searchInput.value.trim().toLowerCase();
                const category = categoryFilter.value;
                const status = statusFilter.value;
                
                // 获取所有文章（包括草稿）
                let allArticles;
                try {
                    // 尝试从API获取数据
                    const response = await fetch('/api/articles/all');
                    
                    if (response.ok) {
                        allArticles = await response.json();
                        // 如果API返回空数组，使用模拟数据
                        if (!allArticles || allArticles.length === 0) {
                            console.log('API返回空数据，使用模拟数据');
                            allArticles = [
                                {_id: '1', title: 'React Hooks 入门指南', category: 'tech', status: 'published', createdAt: new Date(Date.now() - 86400000 * 5).toISOString()},
                                {_id: '2', title: 'Vue 3 Composition API 实践', category: 'tech', status: 'published', createdAt: new Date(Date.now() - 86400000 * 3).toISOString()},
                                {_id: '3', title: '前端性能优化技巧', category: 'tech', status: 'published', createdAt: new Date(Date.now() - 86400000 * 2).toISOString()},
                                {_id: '4', title: '我的学习笔记：JavaScript 异步编程', category: 'emotion', status: 'published', createdAt: new Date(Date.now() - 86400000 * 1).toISOString()},
                                {_id: '5', title: '周末阅读：程序员如何保持创造力', category: 'emotion', status: 'draft', createdAt: new Date().toISOString()}
                            ];
                        }
                    } else {
                        // API请求失败，使用模拟数据
                        console.log('API请求失败，使用模拟数据');
                        allArticles = [
                            {_id: '1', title: 'React Hooks 入门指南', category: 'tech', status: 'published', createdAt: new Date(Date.now() - 86400000 * 5).toISOString()},
                            {_id: '2', title: 'Vue 3 Composition API 实践', category: 'tech', status: 'published', createdAt: new Date(Date.now() - 86400000 * 3).toISOString()},
                            {_id: '3', title: '前端性能优化技巧', category: 'tech', status: 'published', createdAt: new Date(Date.now() - 86400000 * 2).toISOString()},
                            {_id: '4', title: '我的学习笔记：JavaScript 异步编程', category: 'emotion', status: 'published', createdAt: new Date(Date.now() - 86400000 * 1).toISOString()},
                            {_id: '5', title: '周末阅读：程序员如何保持创造力', category: 'emotion', status: 'draft', createdAt: new Date().toISOString()}
                        ];
                    }
                } catch (err) {
                    console.error('API请求异常，使用模拟数据:', err);
                    // 如果发生异常，使用内置的模拟数据
                    allArticles = [
                        {_id: '1', title: 'React Hooks 入门指南', category: 'tech', status: 'published', createdAt: new Date(Date.now() - 86400000 * 5).toISOString()},
                        {_id: '2', title: 'Vue 3 Composition API 实践', category: 'tech', status: 'published', createdAt: new Date(Date.now() - 86400000 * 3).toISOString()},
                        {_id: '3', title: '前端性能优化技巧', category: 'tech', status: 'published', createdAt: new Date(Date.now() - 86400000 * 2).toISOString()},
                        {_id: '4', title: '我的学习笔记：JavaScript 异步编程', category: 'emotion', status: 'published', createdAt: new Date(Date.now() - 86400000 * 1).toISOString()},
                        {_id: '5', title: '周末阅读：程序员如何保持创造力', category: 'emotion', status: 'draft', createdAt: new Date().toISOString()}
                    ];
                }
                
                // 过滤文章
                articles = allArticles.filter(article => {
                    const matchesSearch = !searchTerm || article.title.toLowerCase().includes(searchTerm);
                    const matchesCategory = !category || article.category === category;
                    const matchesStatus = !status || article.status === status;
                    return matchesSearch && matchesCategory && matchesStatus;
                });
                
                // 计算分页
                totalPages = Math.ceil(articles.length / pageSize);
                if (currentPage > totalPages && totalPages > 0) {
                    currentPage = totalPages;
                }
                
                // 截取当前页的文章
                const startIndex = (currentPage - 1) * pageSize;
                const endIndex = Math.min(startIndex + pageSize, articles.length);
                const currentArticles = articles.slice(startIndex, endIndex);
                
                // 更新表格内容
                if (currentArticles.length === 0) {
                    articlesTableBody.innerHTML = `
                        <tr class="text-center">
                            <td colspan="5" class="px-6 py-10 text-gray-500">
                                <i class="fa fa-folder-open-o mr-2" aria-hidden="true"></i> 没有找到符合条件的文章
                            </td>
                        </tr>
                    `;
                } else {
                    articlesTableBody.innerHTML = currentArticles.map(article => `
                        <tr class="table-row">
                            <td class="px-6 py-4 whitespace-nowrap">
                                <div class="text-sm font-medium text-gray-900">${article.title}</div>
                                <div class="text-sm text-gray-500">ID: ${article._id}</div>
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap">
                                <span class="text-sm text-gray-900">${getCategoryName(article.category)}</span>
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap">
                                ${getStatusDisplay(article.status)}
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap">
                                <div class="text-sm text-gray-900">${formatDate(article.createdAt)}</div>
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                                <a href="edit-article.html?id=${article._id}" class="text-primary hover:text-primary/80 mr-3 transition-colors">
                                    <i class="fa fa-pencil" aria-hidden="true"></i> 编辑
                                </a>
                                <button class="text-danger hover:text-danger/80 transition-colors delete-btn" data-id="${article._id}">
                                    <i class="fa fa-trash" aria-hidden="true"></i> 删除
                                </button>
                            </td>
                        </tr>
                    `).join('');
                }
                
                // 更新分页信息
                updatePagination();
                
                // 绑定删除按钮事件
                document.querySelectorAll('.delete-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        selectedArticleId = e.currentTarget.getAttribute('data-id');
                        openDeleteModal();
                    });
                });
                
            } catch (err) {
                console.error('加载文章列表失败:', err);
                articlesTableBody.innerHTML = `
                    <tr class="text-center">
                        <td colspan="5" class="px-6 py-10 text-red-500">
                            <i class="fa fa-exclamation-circle mr-2" aria-hidden="true"></i> 加载失败: ${err.message}
                        </td>
                    </tr>
                `;
            }
        }
        
        // 更新分页
        function updatePagination() {
            // 更新总数显示
            totalItems.textContent = articles.length;
            
            if (articles.length === 0) {
                startItem.textContent = '0';
                endItem.textContent = '0';
                prevPage.disabled = true;
                nextPage.disabled = true;
                prevPageMobile.disabled = true;
                nextPageMobile.disabled = true;
                pageNumbers.innerHTML = '';
                return;
            }
            
            // 更新当前页范围
            const startIndex = (currentPage - 1) * pageSize + 1;
            const endIndex = Math.min(currentPage * pageSize, articles.length);
            startItem.textContent = startIndex;
            endItem.textContent = endIndex;
            
            // 更新分页按钮状态
            prevPage.disabled = currentPage === 1;
            nextPage.disabled = currentPage === totalPages;
            prevPageMobile.disabled = currentPage === 1;
            nextPageMobile.disabled = currentPage === totalPages;
            
            // 更新页码
            pageNumbers.innerHTML = '';
            
            // 简单分页逻辑，显示所有页码
            for (let i = 1; i <= totalPages; i++) {
                const pageButton = document.createElement('button');
                pageButton.className = `relative inline-flex items-center px-4 py-2 border text-sm font-medium ${i === currentPage ? 'bg-primary text-white border-primary' : 'bg-white text-gray-700 border-gray-300 hover:bg-gray-50'}`;
                pageButton.textContent = i;
                pageButton.addEventListener('click', () => {
                    currentPage = i;
                    loadArticles();
                });
                pageNumbers.appendChild(pageButton);
            }
        }
        
        // 打开删除模态框
        function openDeleteModal() {
            deleteModal.classList.remove('hidden');
        }
        
        // 关闭删除模态框
        function closeDeleteModal() {
            deleteModal.classList.add('hidden');
            selectedArticleId = null;
        }
        
        // 删除文章
        async function deleteArticle() {
            if (!selectedArticleId) return;
            
            try {
                // 发送删除请求
                const response = await fetch(`/api/articles/${selectedArticleId}`, {
                    method: 'DELETE'
                });
                
                if (!response.ok) throw new Error('删除失败');
                
                // 关闭模态框
                closeDeleteModal();
                
                // 显示成功通知
                showNotification('文章删除成功');
                
                // 重新加载文章列表
                loadArticles();
                
            } catch (err) {
                console.error('删除文章失败:', err);
                showNotification(`删除失败: ${err.message}`, false);
            }
        }
        
        // 退出登录
        function handleLogout() {
            if (confirm('确定要退出登录吗？')) {
                // 实际项目中这里应该清除登录状态
                showNotification('已成功退出登录');
                setTimeout(() => {
                    // 跳转到首页
                    window.location.href = '/';
                }, 1000);
            }
        }
        
        // 页面加载完成后初始化
        document.addEventListener('DOMContentLoaded', () => {
            // 初始化移动端侧边栏样式
            mobileSidebar.querySelector('div').classList.add('-translate-x-full', 'transition-transform', 'duration-300');
            
            // 加载文章列表
            loadArticles();
            
            // 事件监听
            mobileMenuToggle.addEventListener('click', openMobileSidebar);
            closeMobileSidebar.addEventListener('click', closeMobileSidebarMenu);
            mobileSidebar.addEventListener('click', (e) => {
                if (e.target === mobileSidebar) {
                    closeMobileSidebarMenu();
                }
            });
            logoutBtn.addEventListener('click', handleLogout);
            mobileLogoutBtn.addEventListener('click', handleLogout);
            
            // 搜索和筛选
            searchInput.addEventListener('input', () => {
                currentPage = 1;
                loadArticles();
            });
            categoryFilter.addEventListener('change', () => {
                currentPage = 1;
                loadArticles();
            });
            statusFilter.addEventListener('change', () => {
                currentPage = 1;
                loadArticles();
            });
            
            // 刷新
            refreshBtn.addEventListener('click', () => {
                // 清空搜索和筛选条件
                searchInput.value = '';
                categoryFilter.value = '';
                statusFilter.value = '';
                currentPage = 1;
                // 重新加载
                loadArticles();
            });
            
            // 分页控制
            prevPage.addEventListener('click', () => {
                if (currentPage > 1) {
                    currentPage--;
                    loadArticles();
                }
            });
            nextPage.addEventListener('click', () => {
                if (currentPage < totalPages) {
                    currentPage++;
                    loadArticles();
                }
            });
            prevPageMobile.addEventListener('click', () => {
                if (currentPage > 1) {
                    currentPage--;
                    loadArticles();
                }
            });
            nextPageMobile.addEventListener('click', () => {
                if (currentPage < totalPages) {
                    currentPage++;
                    loadArticles();
                }
            });
            
            // 删除确认
            cancelDelete.addEventListener('click', closeDeleteModal);
            confirmDelete.addEventListener('click', deleteArticle);
            
            // 点击模态框外部关闭
            deleteModal.addEventListener('click', (e) => {
                if (e.target === deleteModal) {
                    closeDeleteModal();
                }
            });
        });
    </script>
</body>
</html>